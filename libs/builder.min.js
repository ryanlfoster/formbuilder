
(function($){$.fn.extend({FormBuilder:function(options){function generateXML(){var str="<formulier>";$(".formbuilder section").each(function(i){str+="<section>";$(this).find(".row").each(function(i){str+="<row>";$(this).find(".colomn").each(function(i){var colomn=$(this);var field=FIELD[$(this).attr("data-name")];str+="<colomn>";var width=0;for(i=1;i<=12;i++){if(colomn.hasClass("col-md-"+i)){width=i}}str+="<width>"+width+"</width>";if(field!==undefined&&field.name!==undefined){str+="<field>"+$(this).attr("data-name")+"</field>";var settings=field.options.split(",");$.each(settings,function(e,t){var n="";if(colomn.attr("data-frm-"+t)!==undefined){n=colomn.attr("data-frm-"+t)}str+="<"+t+">"+n+"</"+t+">"});if(colomn.attr("data-name")=="select"||colomn.attr("data-name")=="checkbox"||colomn.attr("data-name")=="radio"){if(colomn.attr("data-frm-multi")!==undefined){var json=eval("("+colomn.attr("data-frm-multi")+")");$.each(json,function(e,t){str+="<multi><value>"+t.value+"</value><label>"+t.label+"</label></multi>"})}}}str+="</colomn>"});str+="</row>"});str+="</section>"});str+="</formulier>";return str}function generateHTML(){var form="<form></form>";form=$(form);$(".formbuilder section").each(function(i){var section=$("<section><h2>{name}</h2></section>");$(this).find(".row").each(function(i){var row=$('<div class="row"></div>');$(this).find(".colomn").each(function(i){var field=FIELD[$(this).attr("data-name")];var width="col-md-12";var colomn=$(this);for(var i=1;i<=12;i++){if($(this).hasClass("col-md-"+i)){width="col-md-"+i}}var c=$('<div class="'+width+'"></div>');if(field!==undefined&&field.name!==undefined){var settings=field.options.split(",");var html=field.field;$.each(settings,function(e,t){html=html.replace("{"+t+"}",colomn.attr("data-frm-"+t))});$(c).append(html);$.each(settings,function(e,t){if(colomn.attr("data-frm-"+t)!==undefined){$(c).find("input").attr(t,colomn.attr("data-frm-"+t));$(c).find("select").attr(t,colomn.attr("data-frm-"+t));$(c).find("textarea").attr(t,colomn.attr("data-frm-"+t))}});if(colomn.attr("data-name")=="select"){var json="[";$(c).find("select").html("");var j=eval("("+colomn.attr("data-frm-multi")+")");$.each(j,function(e,t){json+="{'label':'"+t.label+"', 'value':'"+t.value+"'},";$(c).find("select").append('<option value="'+t.value+'">'+t.label+"</option>")});json+="]"}else if(colomn.attr("data-name")=="checkbox"){var json="[";$(c).find("input").remove();var j=eval("("+colomn.attr("data-frm-multi")+")");$.each(j,function(e,t){json+="{'label':'"+t.label+"', 'value':'"+t.value+"'},";$(c).append('<label><input type="checkbox" name="'+colomn.attr("data-frm-name")+'[]" value="'+t.value+'">'+t.label+"</label>")});json+="]"}else if(colomn.attr("data-name")=="radio"){var json="[";$(c).find("input").remove();var j=eval("("+colomn.attr("data-frm-multi")+")");$.each(j,function(e,t){json+="{'label':'"+t.label+"', 'value':'"+t.value+"'},";$(c).append('<label><input type="radio" name="'+colomn.attr("data-frm-name")+'" value="'+t.value+'">'+t.label+"</label>")});json+="]"}}row.append(c)});section.append(row)});form.append(section)});return'<form action="'+defaults.formUrl+'" method="POST">'+form.html()+"</form>"}function loadXML(){var e=$.parseXML(defaults.xml);var t="";$(e).find("formulier").each(function(){$(this).find("section").each(function(){var e=$(defaults.newSection);$(this).find("row").each(function(){var t=$(this);var n=$(defaults.newRow);n.find(".colomn").remove();$(this).find("colomn").each(function(){var e=$(this);var t=FIELD[e.find("field").text()];if(t!==undefined&&t.name!==undefined){var i=$('<div class="col-md-'+e.find("width").text()+' colomn"></div>');i.attr("data-name",e.find("field").text());var s=t.options.split(",");var o=t.field;$.each(s,function(t,n){o=o.replace("{"+n+"}",e.find(n).eq(0).text());if(i.attr("data-frm-"+n)!==undefined){$(o).find("input").attr(n,e.find(n).eq(0).text());$(o).find("select").attr(n,e.find(n).eq(0).text());$(o).find("textarea").attr(n,e.find(n).eq(0).text())}i.attr("data-frm-"+n,e.find(n).eq(0).text())});i.append(o);if(e.find("field").text()=="select"){var u="[";$(i).find("select").html("");e.find("multi").each(function(){u+="{'label':'"+$(this).find("label").text()+"', 'value':'"+$(this).find("value").text()+"'},";$(i).find("select").append('<option value="'+$(this).find("value").text()+'">'+$(this).find("label").text()+"</option>")});u+="]";$(i).attr("data-frm-multi",u)}else if(e.find("field").text()=="checkbox"){var u="[";$(i).find("input").remove();$(e).find("multi").each(function(){u+="{'label':'"+$(this).find("label").text()+"', 'value':'"+$(this).find("value").text()+"'},";$(i).append('<label><input type="checkbox" name="'+i.attr("data-frm-name")+'[]" value="'+$(this).find("value").text()+'">'+$(this).find("label").text()+"</label>")});u+="]";$(i).attr("data-frm-multi",u)}else if(e.find("field").text()=="radio"){var u="[";$(i).find("input").remove();$(e).find("multi").each(function(){u+="{'label':'"+$(this).find("label").text()+"', 'value':'"+$(this).find("value").text()+"'},";$(i).append('<label><input type="radio" name="'+i.attr("data-frm-name")+'" value="'+$(this).find("value").text()+'">'+$(this).find("label").text()+"</label>")});u+="]";$(i).attr("data-frm-multi",u)}n.append(i)}});e.append(n)});t+="<section>"+e.html()+"</section>"})});$(".formbuilder").html(t)}function loadSettings(){var frm=$(".formbuilder .colomn.active");var field=FIELD[frm.attr("data-name")];if(field!==undefined&&field.name!==undefined){$(".settings").show();$(".settings > table tr").hide();$(".settings .multi").hide();$(".settings .multi tr:gt(0)").remove();var settings=field.options.split(",");$.each(settings,function(e,t){if(t=="required"){if(frm.attr("data-frm-"+t)=="required"){$(".settings [data-settings="+t+"] input").attr("checked",true);$(".settings [data-settings="+t+"] select").attr("checked",true);$(".settings [data-settings="+t+"] textarea").attr("checked",true)}else{$(".settings [data-settings="+t+"] input").attr("checked",false);$(".settings [data-settings="+t+"] select").attr("checked",false);$(".settings [data-settings="+t+"] textarea").attr("checked",false)}$(".settings [data-settings="+t+"]").show()}else{$(".settings [data-settings="+t+"]").show().find("input").val(frm.attr("data-frm-"+t))}});if(frm.attr("data-name")=="select"||frm.attr("data-name")=="checkbox"||frm.attr("data-name")=="radio"){$(".settings .multi").show();if(frm.attr("data-frm-multi")!==undefined){var json=eval("("+frm.attr("data-frm-multi")+")");$.each(json,function(e,t){$(".settings .multi table").append('<tr><td><input type="text" name="m-label" value="'+t.label+'"></td><td><input type="text" name="m-value"  value="'+t.value+'"></td></tr>')})}else{$(".settings .multi table").append('<tr><td><input type="text" name="m-label"></td><td><input type="text" name="m-value"></td></tr>')}}}else{$(".settings").hide()}}function setSettings(e,t){var n=$(".formbuilder .colomn.active");var r=FIELD[n.attr("data-name")];if(r!==undefined&&r.name!==undefined){var i=r.options.split(",");$.each(i,function(r,i){if(i==e){n.attr("data-frm-"+i,t)}});createForm(n.attr("data-name"))}}function createForm(e){var t=$(".formbuilder .colomn.active");var n=FIELD[e];if(n!==undefined&&n.name!==undefined){t.html(createFieldA(n.options,n.field));var r=n.options.split(",");for(var i=0;i<r.length;i++){var s=t.attr("data-frm-"+r[i]);if(s==undefined){s=""}t.attr("data-frm-"+r[i],s);t.find("input").attr(r[i],s);t.find("select").attr(r[i],s);t.find("textarea").attr(r[i],s)}t.attr("data-name",e)}}function createField(e,t){var n=t;$.each(e,function(e,t){n=n.replace("{"+e+"}",t)});return n}function createFieldA(e,t){var n=$(".formbuilder .colomn.active");var r=t;var i=e.split(",");for(var s=0;s<i.length;s++){var o=n.attr("data-frm-"+i[s]);if(o==undefined){o="";if(i[s]=="name"||i[s]=="label"){o=i[s]}}r=r.replace("{"+i[s]+"}",o);n.attr("data-frm-"+i[s],o)}return r}function setAttr(e,t){$.each(e,function(e,n){t.attr("data-frm-"+e,n)})}function generateFullHTML(){var e="<!doctype html>"+'<html lang="en">'+"<head>"+'<meta charset="UTF-8">'+"<title></title>"+'<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">'+'<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">'+'<script src="http://code.jquery.com/jquery-2.1.0.js"></script>'+'<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>'+'<script src="viewer.js"></script>'+"</head>"+'<body><div class="container">'+generateHTML()+"</div></body></html>";return e}function guid(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function push_to_server(publish){if(defaults.database.database=="couchdb"){$.ajax({url:defaults.database.server+"/"+defaults.database.dbname,type:"PUT",success:function(e){var t=e;if(t.ok==true||t.error=="file_exists"||t.db_name==defaults.database.dbname){alert("Momenteel is deze functie niet beschikbaar")}else{alert("Fout tijdens aanmaken database")}},error:function(e,t,n){alert("Kan geen connectie maken met server.")}})}else if(defaults.database.database=="couchdbproxy"){$.ajax({url:defaults.database.server+"/?action=createdatabase",type:"POST",crossDomain:true,data:{dbname:defaults.database.dbname},success:function(res){var r=eval("("+res+")");if(r.ok==true||r.error=="file_exists"||r.db_name==defaults.database.dbname){if(defaults.formRev.length==0){str={publish:publish,xml:generateXML(),html:generateFullHTML()}}else{str={publish:publish,_rev:defaults.formRev,xml:generateXML(),html:generateFullHTML()}}$.ajax({url:defaults.database.server+"/?action=createdocument&dbname="+defaults.database.dbname+"&id="+defaults.formId,type:"POST",data:str,success:function(res){var r=eval("("+res+")");if(r.id==defaults.formId){alert("Formulier opgeslagen.")}else{alert("Fout tijdens opslagen van formulier.")}},error:function(e,t,n){alert("Kan formulier niet opslaan.")}})}else{alert("Fout tijdens aanmaken database")}},error:function(e,t,n){alert("Kan geen connectie maken met server.")}})}else{alert("No database connected!")}}var defaults={INPUT_TYPES:["text","password","email","submit","nextbutton","prevbutton","select","checkbox","radio","hidden","textarea","number"],preview:false,newRow:'<div class="row"><a href="javascript:void(0);" class="addColomn">Voeg colom toe</a><br><div class="col-md-12 colomn"></div></div>',newSection:'<section><h2>{name}</h2><a href="javascript:void();" class="addRow">add row</a><br></section>',formUrl:"submit.html",xml:"",database:{database:"couchdb",dbname:"formbuilder",username:"",password:"",server:"http://127.0.0.1:5984"},saveTo:"",formId:"",formRev:"",basicHTML:'<!doctype html><html lang="en"><head>'+'<meta charset="UTF-8"><title></title>'+'<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">'+'<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">'+'<script src="https://code.jquery.com/jquery-2.1.0.js"></script>'+'<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>'+'<script src="https://rawgit.com/TPWeb/formbuilder/master/src/viewer/viewer.js"></script>'+"</head>"+'<body><div class="container">{form}</div></body></html>',basicHTMLUrl:""};var CONTAINER=$(this);var FORM=$(this).find(".formbuilder");var FIELD=new Array;FIELD["text"]={name:"tekst veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="text" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="text" name="" value="Hier komt de tekst">',options:"name,label,value,placeholder,required,maxlength"};FIELD["password"]={name:"wachtwoord veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="password" name="{name}" value="" class="form-control"></div>',preview:'<input type="password" name="" value="Hier komt de tekst">',options:"name,label,placeholder,required"};FIELD["email"]={name:"E-mail veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="email" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="email" name="" value="example@example.com">',options:"name,label,value,placeholder,required"};FIELD["submit"]={name:"Verzend knop",field:'<div class="form-group"><input type="submit" value="{value}" class="btn btn-primary"></div>',preview:'<input type="submit" value="Verzenden">',options:"value"};FIELD["nextbutton"]={name:"Volgende knop",field:'<div class="form-group"><input type="submit" value="{value}" class="btn btn-primary next"></div>',preview:'<input type="submit" value="Volgende">',options:"value"};FIELD["prevbutton"]={name:"Vorige knop",field:'<div class="form-group"><input type="submit" value="{value}" class="btn btn-primary prev"></div>',preview:'<input type="submit" value="Vorige">',options:"value"};FIELD["select"]={name:"Keuze lijst",field:'<div class="form-group"><label for="{name}">{label}</label><select name="{name}" class="form-control">{option}</select></div>',preview:'<label for="">Keuze lijst:</label><select name=""><option value="">Optie 1</option><optino value="">Optie 2</option></select>',options:"name,label,required"};FIELD["checkbox"]={name:"Keuze vakjes",field:'<div class="form-group"><label for="{name}">{label}</label></div>',preview:'<label for="">Keuze vakjes:</label><label for=""><input type="checkbox" name="" value="checkbox"> vakje1</label><label for=""><input type="checkbox" name="" value="checkbox"> vakje2</label>',options:"name,label"};FIELD["radio"]={name:"Keuze rondjes",field:'<div class="form-group"><label for="{name}">{label}</label></div>',preview:'<label for="">Keuze rondjes:</label><label for=""><input type="radio" name="" value="radio"> rondje1</label><label for=""><input type="radio" name="" value="radio"> rondje2</label>',options:"name,label"};FIELD["hidden"]={name:"Verborgen veld",field:'<input type="hidden" name="{name}" value="{value}">',preview:'<input type="hidden" name="{name}" value="{value}">',options:"name,value"};FIELD["textarea"]={name:"groot tekst veld",field:'<div class="form-group"><label for="{name}">{label}</label><textarea name="{name}" class="form-control">{value}</textarea></div>',preview:'<textarea name="{name}" class="form-control">Hier komt je tekst</textarea>',options:"name,label,value,placeholder,required"};FIELD["number"]={name:"nummer veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="number" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="number" name="" value="23">',options:"name,label,value,placeholder,required,max,min"};var options=$.extend(defaults,options);var selectedIndex=0;var selectedElement="";if(defaults.xml.length>0){loadXML()}if(defaults.formId.length==0){defaults.formId=guid()}$.each(defaults.INPUT_TYPES,function(e,t){var n=FIELD[t];if(n!==undefined&&n.name!==undefined){CONTAINER.find(".input").append('<li data-name="'+t+'">'+n.name+"</li>")}});$(".addSection").click(function(e){e.preventDefault();var t=$(defaults.newSection);$(".formbuilder").append(t)});$(".formbuilder").on("click",".addRow",function(e){e.preventDefault();var t=$(defaults.newRow);$(this).parent().append(t);$(".colomn").removeClass("active");t.find(".colomn").addClass("active")});$(".formbuilder").on("click",".addColomn",function(e){e.preventDefault();var t=$(this).parent().find("div.colomn").length;t++;var n="col-md-"+Math.floor(12/t);var r=$(this).parent().find(".colomn");r.removeClass("col-md-1");r.removeClass("col-md-2");r.removeClass("col-md-3");r.removeClass("col-md-4");r.removeClass("col-md-5");r.removeClass("col-md-6");r.removeClass("col-md-7");r.removeClass("col-md-8");r.removeClass("col-md-9");r.removeClass("col-md-10");r.removeClass("col-md-11");r.removeClass("col-md-12");r.addClass(n);$(this).parent().append('<div class="'+n+' colomn"></div>')});$(".formbuilder").on("click",".colomn",function(e){e.preventDefault();$(".colomn").removeClass("active");$(this).addClass("active");loadSettings()});$(".input").on("click","li",function(e){e.preventDefault();if($(".formbuilder .colomn.active").length>0){var t=$(this).attr("data-name");var n=FIELD[t];if(n!==undefined&&n.name!==undefined){createForm(t);loadSettings()}}});$(".settings > input[type=submit]").click(function(e){e.preventDefault();var t=$(".formbuilder .colomn.active");var n=FIELD[t.attr("data-name")];if(n!==undefined&&n.name!==undefined){var r=n.options.split(",");$.each(r,function(e,t){if(t=="required"){if($("input[name=required]").is(":checked")){setSettings("required","required")}else{setSettings("required","false")}}else{setSettings(t,$(".settings [name="+t+"]").val())}});if(t.attr("data-name")=="select"){var i="[";t.find("select").html("");$(".settings .multi table tr:gt(0)").each(function(){i+="{'label':'"+$(this).find("[name=m-label]").val()+"', 'value':'"+$(this).find("[name=m-value]").val()+"'},";t.find("select").append('<option value="'+$(this).find("[name=m-value]").val()+'">'+$(this).find("[name=m-label]").val()+"</option>")});i+="]";t.attr("data-frm-multi",i)}else if(t.attr("data-name")=="checkbox"){var i="[";t.find("input").remove();$(".settings .multi table tr:gt(0)").each(function(){i+="{'label':'"+$(this).find("[name=m-label]").val()+"', 'value':'"+$(this).find("[name=m-value]").val()+"'},";t.append('<label><input type="checkbox" name="'+$(".settings [name=name]").val()+'[]" value="'+$(this).find("[name=m-value]").val()+'">'+$(this).find("[name=m-label]").val()+"</label>")});i+="]";t.attr("data-frm-multi",i)}else if(t.attr("data-name")=="radio"){var i="[";t.find("input").remove();$(".settings .multi table tr:gt(0)").each(function(){i+="{'label':'"+$(this).find("[name=m-label]").val()+"', 'value':'"+$(this).find("[name=m-value]").val()+"'},";t.append('<label><input type="radio" name="'+$(".settings [name=name]").val()+'" value="'+$(this).find("[name=m-value]").val()+'">'+$(this).find("[name=m-label]").val()+"</label>")});i+="]";t.attr("data-frm-multi",i)}}});$(".settings .multi input[type=submit]").click(function(e){e.preventDefault();$(".multi table").append('<tr><td><input type="text" name="m-label"></td><td><input type="text" name="m-value"></td></tr>')});$("input[type=submit].xml").click(function(e){e.preventDefault();alert(generateXML())});$("input[type=submit].html").click(function(e){e.preventDefault();alert(generateHTML())});$("input[type=submit].importxml").click(function(e){e.preventDefault();defaults.xml=$('textarea[name="importxml"]').val();loadXML()});$("input[type=submit].save").click(function(e){e.preventDefault();push_to_server(0)});$("input[type=submit].publish").click(function(e){e.preventDefault();push_to_server(1)})}})})(jQuery)