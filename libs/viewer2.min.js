/************************************************
 *												*
 *		Project: formbuilder 					*
 *		Created by: Tjebbe Lievens				*
 *		https://github.com/TPWeb/formbuilder	*
 *												*
 *		JavaScript JQuery viewer lib 			*
 *												*
 ************************************************/

!function($){$.fn.extend({FormViewer:function(options){function loadHTML(){var html="";if("couchdb"==defaults.database.database){$.couch.urlPrefix=defaults.database.server,defaults.database.username.length>0&&$.couch.login({name:defaults.database.username,password:defaults.database.password});var db=$.couch.db(defaults.database.dbname);db.openDoc(defaults.formId,{success:function(e){void 0!==e.html?($("body").html(loadXML(e.xml)),formLoaded()):alert("Formulier kon niet worden geladen.")},error:function(){alert("Formulier kon niet worden geladen.")}})}else"couchdbproxy"==defaults.database.database?$.ajax({url:defaults.database.server+"/?action=createdatabase",type:"POST",crossDomain:!0,data:{dbname:defaults.database.dbname},success:function(res){var r=eval("("+res+")");1==r.ok||"file_exists"==r.error||r.db_name==defaults.database.dbname?$.ajax({url:defaults.database.server+"/?action=getdocument&dbname="+defaults.database.dbname+"&id="+defaults.formId,type:"GET",success:function(res){var r=eval("("+res+")");r.id==defaults.formId?($("body").html(loadXML(r.xml)),formLoaded()):alert("Fout tijdens laden van formulier.")},error:function(){alert("Kan formulier niet laden.")}}):alert("Fout tijdens aanmaken database")},error:function(){alert("Kan geen connectie maken met server.")}}):"couchbase"==defaults.database.database?$.ajax({url:defaults.database.server+"/"+defaults.database.dbname,type:"GET",crossDomain:!0,success:function(res){$.ajax({url:defaults.database.server+"/"+defaults.database.dbname+"/"+defaults.formId,type:"GET",success:function(res){var r=eval("("+res+")");r.id==defaults.formId?($("body").html(loadXML(r.xml)),formLoaded()):alert("Fout tijdens laden van formulier.")},error:function(){alert("Kan formulier niet laden.")}})},error:function(){alert("Kan geen connectie maken met server.")},dataType:"json"}):alert("No database connected!")}function loadXML(e){var a=$.parseXML(e),t="<form action='' method='post'>";return $(a).find("formulier").each(function(){$(this).find("section").each(function(){var e=$(defaults.existSection);$(this).find("row").each(function(){var a=($(this),$(defaults.newRow));a.find(".colomn").remove(),$(this).find("colomn").each(function(){var e=$(this),t=FIELD[e.find("field").text()];if(void 0!==t&&void 0!==t.name){var l=$('<div class="col-md-'+e.find("width").text()+' colomn"></div>'),n=t.options.split(","),i=t.field;if($.each(n,function(a,t){i=i.replace("{"+t+"}",e.find(t).eq(0).text())}),$.each(n,function(a,t){$(i).find("select").attr(t,e.find(t).eq(0).text()),$(i).find("textarea").attr(t,e.find(t).eq(0).text()),l.attr("data-frm-"+t,e.find(t).eq(0).text())}),alert(i),l.append(i),"select"==e.find("field").text()){var r="[";$(l).find("select").html(""),e.find("multi").each(function(){r+="{'label':'"+$(this).find("label").text()+"', 'value':'"+$(this).find("value").text()+"'},",$(l).find("select").append('<option value="'+$(this).find("value").text()+'">'+$(this).find("label").text()+"</option>")}),r+="]"}else if("checkbox"==e.find("field").text()){var r="[";$(l).find("input").remove(),$(e).find("multi").each(function(){r+="{'label':'"+$(this).find("label").text()+"', 'value':'"+$(this).find("value").text()+"'},",$(l).append('<label><input type="checkbox" name="'+l.attr("data-frm-name")+'[]" value="'+$(this).find("value").text()+'">'+$(this).find("label").text()+"</label>")}),r+="]"}else if("radio"==e.find("field").text()){var r="[";$(l).find("input").remove(),$(e).find("multi").each(function(){r+="{'label':'"+$(this).find("label").text()+"', 'value':'"+$(this).find("value").text()+"'},",$(l).append('<label><input type="radio" name="'+l.attr("data-frm-name")+'" value="'+$(this).find("value").text()+'">'+$(this).find("label").text()+"</label>")}),r+="]"}a.append(l)}}),e.append(a)}),t+="<section>"+e.html()+"</section>"})}),t+="</form>"}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function formLoaded(){$("section:gt(0)").hide()}var defaults={databaseData:{database:"couchdb",dbname:"formdata",username:"",password:"",server:"http://127.0.0.1:5984"},database:{database:"couchdb",dbname:"formbuilder",username:"",password:"",server:"http://127.0.0.1:5984"},saveTo:"",dataId:"",dataRev:"",formId:"",newRow:'<div class="row"><div class="col-md-12 colomn"></div></div>',newSection:'<section><div class="row"><div class="col-md-12 colomn active" data-frm-label="label" data-name="h1"><h1>label</h1></div></div></section>',existSection:"<section></section>"},CONTAINER=$(this),FORM=$(this).find(".formbuilder"),options=$.extend(defaults,options),selectedIndex=0,selectedElement="";0==defaults.dataId.length&&(defaults.dataId=guid()),loadHTML();var FIELD=new Array;FIELD.text={name:"tekst veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="text" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="text" name="" value="Hier komt de tekst">',options:"name,label,value,placeholder,required,maxlength"},FIELD.password={name:"wachtwoord veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="password" name="{name}" value="" class="form-control"></div>',preview:'<input type="password" name="" value="Hier komt de tekst">',options:"name,label,placeholder,required"},FIELD.email={name:"E-mail veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="email" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="email" name="" value="example@example.com">',options:"name,label,value,placeholder,required"},FIELD.url={name:"url veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="url" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="email" name="" value="http://www.example.com">',options:"name,label,value,placeholder,required"},FIELD.submit={name:"Verzend knop",field:'<div class="form-group"><input type="submit" value="{value}" class="btn btn-primary"></div>',preview:'<input type="submit" value="Verzenden">',options:"value"},FIELD.nextbutton={name:"Volgende knop",field:'<div class="form-group"><input type="submit" value="{value}" class="btn btn-primary next"></div>',preview:'<input type="submit" value="Volgende">',options:"value"},FIELD.prevbutton={name:"Vorige knop",field:'<div class="form-group"><input type="submit" value="{value}" class="btn btn-primary prev"></div>',preview:'<input type="submit" value="Vorige">',options:"value"},FIELD.select={name:"Keuze lijst",field:'<div class="form-group"><label for="{name}">{label}</label><select name="{name}" class="form-control">{option}</select></div>',preview:'<label for="">Keuze lijst:</label><select name=""><option value="">Optie 1</option><optino value="">Optie 2</option></select>',options:"name,label,required"},FIELD.checkbox={name:"Keuze vakjes",field:'<div class="form-group"><label for="{name}">{label}</label></div>',preview:'<label for="">Keuze vakjes:</label><label for=""><input type="checkbox" name="" value="checkbox"> vakje1</label><label for=""><input type="checkbox" name="" value="checkbox"> vakje2</label>',options:"name,label"},FIELD.radio={name:"Keuze rondjes",field:'<div class="form-group"><label for="{name}">{label}</label></div>',preview:'<label for="">Keuze rondjes:</label><label for=""><input type="radio" name="" value="radio"> rondje1</label><label for=""><input type="radio" name="" value="radio"> rondje2</label>',options:"name,label"},FIELD.hidden={name:"Verborgen veld",field:'<input type="hidden" name="{name}" value="{value}">',preview:'<input type="hidden" name="{name}" value="{value}">',options:"name,value"},FIELD.textarea={name:"groot tekst veld",field:'<div class="form-group"><label for="{name}">{label}</label><textarea name="{name}" class="form-control">{value}</textarea></div>',preview:'<textarea name="{name}" class="form-control">Hier komt je tekst</textarea>',options:"name,label,value,placeholder,required"},FIELD.number={name:"nummer veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="number" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="number" name="" value="23">',options:"name,label,value,placeholder,required,max,min"},FIELD.date={name:"datum veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="date" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="date" name="" value="2014-01-01">',options:"name,label,value,placeholder,required"},FIELD.datetime={name:"datum en tijd veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="datetime" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="date" name="" value="2014-01-01 12:00:00">',options:"name,label,value,placeholder,required"},FIELD.time={name:"tijd veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="time" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="time" name="" value="12:00:00">',options:"name,label,value,placeholder,required"},FIELD.range={name:"range veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="range" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="range" name="" value="10" min="0" max="30">',options:"name,label,value,placeholder,required,min,max"},FIELD.color={name:"kleur veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="color" name="{name}" class="form-control"></div>',preview:'<input type="color" name="">',options:"name,label,placeholder,required"},FIELD.month={name:"maand veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="month" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="color" name="">',options:"name,label,value,placeholder,required"},FIELD.week={name:"week veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="week" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="week" name="" value="">',options:"name,label,value,placeholder,required"},FIELD.tel={name:"telefoon veld",field:'<div class="form-group"><label for="{name}">{label}</label><input type="tel" name="{name}" value="{value}" class="form-control"></div>',preview:'<input type="tel" name="" value="">',options:"name,label,value,placeholder,required"},FIELD.h1={name:"Heading 1",field:"<h1>{label}</h1>",preview:"<h1>Heading 1</h1>",options:"label"},FIELD.h2={name:"Heading 2",field:"<h2>{label}</h2>",preview:"<h2>Heading 2</h2>",options:"label"},FIELD.h3={name:"Heading 3",field:"<h3>{label}</h3>",preview:"<h3>Heading 3</h3>",options:"label"},FIELD.h4={name:"Heading 4",field:"<h4>{label}</h4>",preview:"<h4>Heading 4</h4>",options:"label"},FIELD.p={name:"Paragraph",field:"<p>{label}</p>",preview:"<p>Hier komt je tekst</p>",options:"label"},$("html").on("click",".next",function(e){e.preventDefault();var a=$(this).parent().parent().parent().parent(),t=!0;a.find("input").each(function(){("required"==$(this).attr("required")||"true"==$(this).attr("required"))&&$(this).val().length<1&&(alert($(this).attr("label")+" moet verplicht worden ingevuld."),t=!1),void 0!==$(this).attr("maxlength")&&parseInt($(this).attr("maxlength"))>0&&$(this).val().length>parseInt($(this).attr("maxlength"))&&(alert($(this).attr("label")+" is te lang. Dit mag maximum "+$(this).attr("maxlength")+" karakters lang zijn."),t=!1),void 0!==$(this).attr("max")&&parseInt($(this).val())>parseInt($(this).attr("max"))&&(alert($(this).attr("label")+" is te hoog. De maximum waarde is "+$(this).attr("max")),t=!1),void 0!==$(this).attr("min")&&parseInt($(this).val())<parseInt($(this).attr("min"))&&(alert($(this).attr("label")+" is te laag. De minimum waarde is "+$(this).attr("min")),t=!1)}),t&&(a.hide(),a.next().show())}),$("html").on("click",".prev",function(e){e.preventDefault();var a=$(this).parent().parent().parent().parent(),t=!0;a.find("input").each(function(){("required"==$(this).attr("required")||"true"==$(this).attr("required"))&&$(this).val().length<1&&(alert($(this).attr("label")+" moet verplicht worden ingevuld."),t=!1),void 0!==$(this).attr("maxlength")&&$(this).val().length>parseInt($(this).attr("maxlength"))&&(alert($(this).attr("label")+" is te lang. Dit mag maximum "+$(this).attr("maxlength")+" karakters lang zijn."),t=!1),void 0!==$(this).attr("max")&&parseInt($(this).val())>parseInt($(this).attr("max"))&&(alert($(this).attr("label")+" is te hoog. De maximum waarde is "+$(this).attr("max")),t=!1),void 0!==$(this).attr("min")&&parseInt($(this).val())<parseInt($(this).attr("min"))&&(alert($(this).attr("label")+" is te laag. De minimum waarde is "+$(this).attr("min")),t=!1)}),t&&(a.hide(),a.prev().show())}),$(document).on("submit","form",function(e){e.preventDefault();var a=!0;if($(this).find("input").each(function(){("required"==$(this).attr("required")||"true"==$(this).attr("required"))&&$(this).val().length<1&&(alert($(this).attr("label")+" moet verplicht worden ingevuld."),a=!1),void 0!==$(this).attr("maxlength")&&$(this).val().length>parseInt($(this).attr("maxlength"))&&(alert($(this).attr("label")+" is te lang. Dit mag maximum "+$(this).attr("maxlength")+" karakters lang zijn."),a=!1),void 0!==$(this).attr("max")&&parseInt($(this).val())>parseInt($(this).attr("max"))&&(alert($(this).attr("label")+" is te hoog. De maximum waarde is "+$(this).attr("max")),a=!1),void 0!==$(this).attr("min")&&parseInt($(this).val())<parseInt($(this).attr("min"))&&(alert($(this).attr("label")+" is te laag. De minimum waarde is "+$(this).attr("min")),a=!1)}),a){if("couchdb"==defaults.databaseData.database){$.couch.urlPrefix=defaults.databaseData.server,defaults.databaseData.username.length>0&&$.couch.login({name:defaults.databaseData.username,password:defaults.databaseData.password});var t=$.couch.db(defaults.databaseData.dbname),l={},n=$(this).serializeArray();$.each(n,function(){void 0!==l[this.name]?(l[this.name].push||(l[this.name]=[l[this.name]]),l[this.name].push(this.value||"")):l[this.name]=this.value||""}),t.saveDoc(l,{success:function(e){defaults.dataRev=e._rev,defaults.dataId=e._id,alert("Formulier is verzonden!")},error:function(){alert("Kan formulier niet verzenden.")}})}}else;})}})}(jQuery);