package org.tpweb.formbuilder;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import android.app.Activity;
import android.content.Intent;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.webkit.WebView;
import android.widget.TextView;

public class FormViewer extends Activity {
	private WebView webview;
	private CouchDB couchdb;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.formviewer);
		webview = (WebView) findViewById(R.id.webview);
		couchdb = new CouchDB("formbuilder", MainActivity.server, MainActivity.serverPort, "http");


		if (getIntent() != null) { // send intent to show only favorite songs
			Bundle extras = getIntent().getExtras();
			String id = extras.getString("id");
			
			
				String customHtml = retrievedDocument.getProperties().get("html").toString();
				webview.loadData(customHtml, "text/html", "UTF-8");
			} else {
				Intent i = new Intent(getApplicationContext(), MainActivity.class);
				i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
				startActivity(i);
			}
		} else {
			Intent i = new Intent(getApplicationContext(), MainActivity.class);
			i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
			startActivity(i);
		}
	}

	private class LoadData extends AsyncTask<Object, Void, Object> {
		private TextView _title;

		@Override
		protected Object doInBackground(Object... arg) {
			this._title = (TextView) arg[1];
			return couchdb.getDocument(arg[0] + "");
		}

		@Override
		protected void onPostExecute(Object result) {
			if(result != null) {
				try {
					JSONObject json = (JSONObject)result;
					JSONArray names = json.names();
					for(int i = 0; i < names.length(); i++) {
						_title.setText(json.getString("_id"));
						Log.i("couchdb", names.get(i).toString());
					}
				} catch (JSONException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}

		@Override
		protected void onPreExecute() {
		}

		@Override
		protected void onProgressUpdate(Void... values) {

		}

	}
}
