package org.tpweb.formbuilder;

import android.app.Activity;
import android.webkit.WebView;

public class FormViewer extends Activity {
	private WebView webview;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.formviewer);
		webview = (WebView) findViewById(R.id.webview);

		try {
			manager = new Manager(getApplicationContext().getFilesDir(), Manager.DEFAULT_OPTIONS);
		} catch (IOException e) {
			Log.e(TAG, "Cannot create manager object");
			return;
		}

		// create a name for the database and make sure the name is legal
		String dbname = "forms";
		if (!Manager.isValidDatabaseName(dbname)) {
			Log.e(TAG, "Bad database name");
			return;
		}

		// create a new database
		try {
			database = manager.getDatabase(dbname);
		} catch (CouchbaseLiteException e) {
			Log.e(TAG, "Cannot get database");
			return;
		}
		if (getIntent() != null) { // send intent to show only favorite songs
			Bundle extras = getIntent().getExtras();

			Document retrievedDocument = database.getDocument(extras.getString("id"));
			Log.d(TAG, "retrievedDocument=" + String.valueOf(retrievedDocument.getProperties()));
			webview.getSettings().setJavaScriptEnabled(true);
			//webView.loadUrl("http://www.google.com");
			if(retrievedDocument.getProperties().containsKey("html")) {
				String customHtml = retrievedDocument.getProperties().get("html").toString();
				webview.loadData(customHtml, "text/html", "UTF-8");
			} else {
				Intent i = new Intent(getApplicationContext(), MainActivity.class);
				i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
				startActivity(i);
			}
		} else {
			Intent i = new Intent(getApplicationContext(), MainActivity.class);
			i.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
			startActivity(i);
		}
	}
}
